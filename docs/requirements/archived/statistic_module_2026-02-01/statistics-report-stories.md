# 统计报告模块 - Epic & Story 分解

**项目**: 江原创业门户 - 统计报告模块  
**版本**: v1.0  
**创建日期**: 2026-02-01  
**参考文档**: [PRD-006](../prd_statistics_report.md)

---

## Epic 概览

| Epic ID | Epic 名称 | 优先级 | 预估工时 | 状态 |
|---------|----------|--------|----------|------|
| EPIC-001 | 复合筛选系统 | P0 | 5天 | 待开始 |
| EPIC-002 | 数据展示与分页 | P0 | 3天 | 待开始 |
| EPIC-003 | 数据导出功能 | P1 | 2天 | 待开始 |
| EPIC-004 | 性能优化 | P1 | 2天 | 待开始 |

---

## EPIC-001: 复合筛选系统

**目标**: 实现多维度的企业数据筛选功能

**业务价值**: 管理员可以通过多种条件组合快速定位目标企业群体

### Story 1.1: 基础筛选 - 时间与关键词

**优先级**: P0  
**预估**: 1天  
**依赖**: 无

**用户故事**:
作为管理员，我想要通过年度/季度/月份和关键词搜索企业，以便快速定位特定时间段的企业数据。

**验收标准**:
- [ ] 支持年度选择（默认 2025）
- [ ] 支持季度选择（Q1-Q4，可选）
- [ ] 支持月份选择（1-12，可选）
- [ ] 支持关键词搜索（企业名称或事业者编号）
- [ ] 时间筛选支持联动（选择年度后可选季度，选择季度后可选月份）
- [ ] 关键词搜索支持模糊匹配

**技术任务**:
- [ ] 前端: 创建时间筛选组件 (TimeFilter.jsx)
- [ ] 前端: 创建关键词搜索组件 (SearchInput.jsx)
- [ ] 后端: 实现时间范围查询逻辑
- [ ] 后端: 实现关键词模糊搜索

---

### Story 1.2: 产业筛选 - KSIC 与主导产业

**优先级**: P0  
**预估**: 1.5天  
**依赖**: Story 1.1

**用户故事**:
作为管理员，我想要按照标准产业分类和江原道主导产业筛选企业，以便统计特定行业的企业分布。

**验收标准**:
- [ ] 支持 KSIC 大类选择（A-U）
- [ ] 支持 KSIC 中类选择（二级联动）
- [ ] 支持江原道主导产业选择（天然物生物材料、陶瓷原料材料、数字医疗保健）
- [ ] 主导产业映射到对应的 KSIC 代码（参考 PRD Page 3）
- [ ] 支持多选功能

**技术任务**:
- [ ] 前端: 创建产业筛选组件 (IndustryFilter.jsx)
- [ ] 前端: 实现 KSIC 二级联动逻辑
- [ ] 后端: 配置主导产业 KSIC 映射表
- [ ] 后端: 实现产业代码查询逻辑

---

### Story 1.3: 政策关联筛选

**优先级**: P0  
**预估**: 1天  
**依赖**: Story 1.1

**用户故事**:
作为管理员，我想要筛选参与特定政策项目的企业，以便统计各扶持计划的参与情况。

**验收标准**:
- [ ] 支持创业中心大学项目筛选
- [ ] 支持全球事业项目筛选
- [ ] 支持 RISE 事业团项目筛选
- [ ] 支持多选（OR 逻辑）
- [ ] 未选择时不应用此筛选条件

**技术任务**:
- [ ] 前端: 创建政策筛选组件 (PolicyFilter.jsx)
- [ ] 后端: 查询企业参与项目信息
- [ ] 后端: 实现 OR 逻辑查询

---

### Story 1.4: 投资情况筛选

**优先级**: P0  
**预估**: 1天  
**依赖**: Story 1.1

**用户故事**:
作为管理员，我想要按投资引进情况筛选企业，以便识别获得高额投资的优质企业。

**验收标准**:
- [ ] 支持投资引进与否筛选（是/否/全部）
- [ ] 支持投资金额范围筛选
- [ ] 提供预设区间（1000万以上、5000万以上、1亿以上）
- [ ] 支持自定义区间输入（最小值-最大值）
- [ ] 选择"否"时自动禁用金额筛选
- [ ] 金额单位为万元（韩元）

**技术任务**:
- [ ] 前端: 创建投资筛选组件 (InvestmentFilter.jsx)
- [ ] 前端: 实现金额范围输入验证
- [ ] 后端: 统计企业总投资额
- [ ] 后端: 实现金额范围查询

---

### Story 1.5: 知识产权筛选

**优先级**: P0  
**预估**: 0.5天  
**依赖**: Story 1.1

**用户故事**:
作为管理员，我想要按专利持有数量筛选企业，以便发现具有高技术含量的企业。

**验收标准**:
- [ ] 支持专利数量范围筛选
- [ ] 提供预设区间（1个以上、3个以上、5个以上、10个以上）
- [ ] 支持自定义区间输入（最小值-最大值）
- [ ] 统计包含所有类型的专利

**技术任务**:
- [ ] 前端: 创建专利筛选组件 (PatentFilter.jsx)
- [ ] 后端: 统计企业专利总数
- [ ] 后端: 实现数量范围查询

---

## EPIC-002: 数据展示与分页

**目标**: 展示筛选结果并支持分页、排序

**业务价值**: 管理员可以清晰查看筛选结果并进行进一步分析

### Story 2.1: 结果列表展示

**优先级**: P0  
**预估**: 1.5天  
**依赖**: EPIC-001 所有 Story

**用户故事**:
作为管理员，我想要看到筛选后的企业列表，以便了解符合条件的企业详情。

**验收标准**:
- [ ] 显示事业者注册号
- [ ] 显示企业名称
- [ ] 显示所属业种（KSIC）
- [ ] 显示创业阶段
- [ ] 显示参与项目标签（多个用逗号分隔）
- [ ] 显示投资引进总额（千分位格式化）
- [ ] 显示专利持有数量
- [ ] 显示年营收（千分位格式化）
- [ ] 显示出口额

**技术任务**:
- [ ] 前端: 创建结果表格组件 (StatisticsTable.jsx)
- [ ] 前端: 实现数字千分位格式化
- [ ] 前端: 实现标签展示逻辑
- [ ] 后端: 实现统计查询 API

---

### Story 2.2: 分页与排序

**优先级**: P0  
**预估**: 1天  
**依赖**: Story 2.1

**用户故事**:
作为管理员，我想要对结果进行分页和排序，以便更好地浏览大量数据。

**验收标准**:
- [ ] 支持分页（默认每页 10 条）
- [ ] 支持切换每页条数（10/20/50/100）
- [ ] 显示总记录数
- [ ] 支持按投资额排序
- [ ] 支持按专利数排序
- [ ] 支持按营收排序
- [ ] 支持升序/降序切换

**技术任务**:
- [ ] 前端: 实现分页组件
- [ ] 前端: 实现表头排序功能
- [ ] 后端: 实现分页逻辑
- [ ] 后端: 实现排序逻辑

---

### Story 2.3: 加载状态与空状态

**优先级**: P1  
**预估**: 0.5天  
**依赖**: Story 2.1

**用户故事**:
作为管理员，我想要看到清晰的加载和空状态提示，以便了解系统状态。

**验收标准**:
- [ ] 查询时显示 Skeleton Screen 或 Loading 遮罩
- [ ] 无结果时显示友好的空状态提示
- [ ] 查询失败时显示错误信息

**技术任务**:
- [ ] 前端: 创建 Loading 组件
- [ ] 前端: 创建 Empty State 组件
- [ ] 前端: 创建 Error State 组件

---

## EPIC-003: 数据导出功能

**目标**: 支持将筛选结果导出为 Excel

**业务价值**: 管理员可以进行线下分析和生成报告

### Story 3.1: Excel 导出

**优先级**: P1  
**预估**: 1.5天  
**依赖**: EPIC-002

**用户故事**:
作为管理员，我想要将筛选结果导出为 Excel，以便进行线下分析。

**验收标准**:
- [ ] 点击"Excel 下载"按钮触发导出
- [ ] 文件名格式：`강원기업통계리포트_YYYYMMDD.xlsx`
- [ ] 包含所有展示列
- [ ] 首行显示筛选条件摘要
- [ ] 代表者手机号脱敏显示（010-****-1234）
- [ ] 底部包含导出人和导出时间
- [ ] 单次最多导出 10,000 条记录

**技术任务**:
- [ ] 前端: 创建导出按钮和进度提示
- [ ] 后端: 实现 Excel 导出 API
- [ ] 后端: 实现 PII 脱敏逻辑
- [ ] 后端: 添加导出记录限制

---

### Story 3.2: 导出进度提示

**优先级**: P2  
**预估**: 0.5天  
**依赖**: Story 3.1

**用户故事**:
作为管理员，我想要看到导出进度，以便了解导出状态。

**验收标准**:
- [ ] 导出时显示进度提示
- [ ] 导出完成后自动下载
- [ ] 导出失败时显示错误信息

**技术任务**:
- [ ] 前端: 实现导出进度 UI
- [ ] 前端: 处理下载逻辑

---

## EPIC-004: 性能优化

**目标**: 确保系统在大数据量下的性能

**业务价值**: 提升用户体验，确保系统稳定性

### Story 4.1: 数据库索引优化

**优先级**: P1  
**预估**: 1天  
**依赖**: EPIC-001, EPIC-002

**用户故事**:
作为系统，我需要快速响应查询请求，以便管理员获得流畅的使用体验。

**验收标准**:
- [ ] 查询响应时间 < 2秒（万级数据）
- [ ] 为常用筛选字段创建索引
- [ ] 优化复杂查询的执行计划

**技术任务**:
- [ ] 后端: 为参与项目字段创建索引
- [ ] 后端: 为投资状态字段创建索引
- [ ] 后端: 为专利数量字段创建索引
- [ ] 后端: 分析并优化慢查询

---

### Story 4.2: 前端性能优化

**优先级**: P2  
**预估**: 1天  
**依赖**: EPIC-002

**用户故事**:
作为管理员，我想要页面快速加载和响应，以便高效完成工作。

**验收标准**:
- [ ] 页面首次加载时间 < 3秒
- [ ] 筛选操作响应流畅
- [ ] 大数据量表格渲染优化

**技术任务**:
- [ ] 前端: 实现虚拟滚动（如需要）
- [ ] 前端: 优化组件渲染性能
- [ ] 前端: 实现防抖/节流

---

## 依赖关系图

```
EPIC-001 (复合筛选系统)
  ├─ Story 1.1 (基础筛选) ──┐
  ├─ Story 1.2 (产业筛选) ──┤
  ├─ Story 1.3 (政策筛选) ──┼─→ EPIC-002 (数据展示)
  ├─ Story 1.4 (投资筛选) ──┤    ├─ Story 2.1 (列表展示)
  └─ Story 1.5 (专利筛选) ──┘    ├─ Story 2.2 (分页排序)
                                  └─ Story 2.3 (加载状态)
                                       │
                                       ├─→ EPIC-003 (数据导出)
                                       │    ├─ Story 3.1 (Excel导出)
                                       │    └─ Story 3.2 (导出进度)
                                       │
                                       └─→ EPIC-004 (性能优化)
                                            ├─ Story 4.1 (数据库优化)
                                            └─ Story 4.2 (前端优化)
```

---

## 开发排期建议

### Sprint 1 (5天) - 核心功能
- Story 1.1: 基础筛选
- Story 1.2: 产业筛选
- Story 1.3: 政策筛选
- Story 1.4: 投资筛选
- Story 1.5: 专利筛选

### Sprint 2 (3天) - 数据展示
- Story 2.1: 结果列表展示
- Story 2.2: 分页与排序
- Story 2.3: 加载状态

### Sprint 3 (2天) - 导出功能
- Story 3.1: Excel 导出
- Story 3.2: 导出进度

### Sprint 4 (2天) - 优化与测试
- Story 4.1: 数据库优化
- Story 4.2: 前端优化
- 集成测试与 Bug 修复

**总计**: 12 个工作日

---

## 技术栈

**前端**:
- React 18.3+
- Zustand (状态管理)
- TanStack Query (数据缓存)
- ECharts (图表，如需要)
- Tailwind CSS

**后端**:
- FastAPI 0.115+
- SQLAlchemy 2.0+ (异步 ORM)
- PostgreSQL (Supabase)
- openpyxl (Excel 导出)

---

## 风险与缓解

| 风险 | 影响 | 概率 | 缓解措施 |
|------|------|------|----------|
| 数据量过大导致查询慢 | 高 | 中 | 提前创建索引，实现分页查询 |
| 主导产业 KSIC 映射复杂 | 中 | 低 | 使用配置文件管理映射关系 |
| Excel 导出超时 | 中 | 中 | 限制单次导出数量，考虑异步导出 |
| 筛选条件组合复杂 | 中 | 低 | 充分测试各种组合场景 |

---

**文档状态**: Phase 4 完成  
**下一步**: Phase 5 - 数据库设计检查
