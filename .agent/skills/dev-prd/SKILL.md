---
name: dev-prd
description: PRD 编写专家。专注于 AI/RAG 项目的需求定义，确保功能描述、验收标准与 TDD 及前端模式完美衔接。
---

# PRD 编写规范 (AI & RAG 专项)

## 触发场景

- 定义新功能或重构现有模块
- 编写用户故事（User Stories）和验收标准（Acceptance Criteria）
- 分析 AI 检索逻辑（RAG）和生成质量要求
- 评估系统非功能性需求（性能、安全、扩展性）

## 前置依赖

> **⚠️ 开始编写前，必须先检查以下 skill：**
>
> 1. **`dev-terminology`** - 确保功能命名符合项目术语字典
> 2. **`dev-tdd_workflow`** - 确保验收标准（AC）可转化为测试用例

## 核心原则

### 1. 术语一致性 (Terminology)

需求文档中的所有业务对象、状态、角色命名必须严格遵守 **`dev-terminology`**。

- 例如：文档的状态应统一使用 `Indexed` 而非 `Analyzed`，用户角色应统一使用 `Analyst` 而非 `Expert`。

### 2. UI/UX 体验设计 (User Experience)

PRD 必须定义符合 **`dev-frontend_patterns`** 的用户交互流程：

- **Premium 设计**：明确要求使用柔和渐变、毛玻璃效果和现代卡片流式布局。
- **微互动**：定义 Loading、Success、Error 状态下的动效反馈。
- **一致性**：所有按钮及表单组件必须优先复用 `shared/components/ui` 中的标准库。

### 3. 组件与库兼容性 (Compatibility)

在定义涉及特殊解析或渲染（如 PDF 预览、复杂图表）的需求时，必须检查 **`dev-libs_compatibility`**：

- 评估第三方库（如 `recharts`, `pdfjs`）的版本支持及浏览器兼容性。
- 确保新增组件不会与现有 `Common UI` 产生样式冲突。

### 4. 技术与业务融合

需求不仅要描述“用户看到什么”，还要明确“AI 如何检索”。必须说明检索 Top-K 设定、引用格式以及“未找到回复”的回退策略。

### 5. 可测性 (Testability)

每一个验收标准（Acceptance Criteria）必须是可验证的。

- ❌ 错误：系统响应要快。
- ✅ 正确：API 在 50 个并发用户下，P95 响应时间应小于 3 秒。

### 6. 国际化 (i18n)

由于是渥太华城市项目，所有功能点必须明确处理英语和法语的支持。

## PRD 标准结构

### 1. 执行摘要与目标

- 产品/功能名称与版本
- 核心业务痛点：解决了分析师的什么问题？
- 成功指标：如 Accuracy >= 75%, Faithfulness >= 90%。

### 2. 用户故事 (User Stories)

采用标准格式：

> **作为** [角色], **我想要** [动作], **以便** [收益]。

### 3. 功能需求 (Functional Requirements)

- **RAG 逻辑**：数据源范围、分片策略提示、Prompt 核心要求。
- **UI/UX 逻辑**：组件级的功能描述。
- **国际化要求**：英法双语的显示与切换逻辑。

### 4. 验收标准 (Acceptance Criteria) - 核心

必须包含：

- **功能路径**：用户操作的成功路径。
- **AI 质量**：引用来源的准确性、置信度阈值。
- **美学校验**：是否符合现代 UI 规范。
- **边界套件**：空数据、网络延迟、超长文本处理。

### 5. 非功能需求 (Non-Functional Requirements)

- **性能**：P95 响应时间、最大并发支持。
- **安全**：Azure Entra ID 权限校验、数据脱敏。

## 模板示例

### 用户故事与 AC 示例

```markdown
#### US-001: 语义搜索

**作为** 经济发展分析师，  
**我想要** 使用自然语言提问，  
**以便** 即使没有精确关键词也能找到相关的季度报告数据。

**验收标准**:

1. [ ] 用户输入自然语言后，系统在 3s 内返回结果。
2. [ ] 结果必须包含准确的引用来源（文档名、页码、原文摘要）。
3. [ ] 界面展示应使用渐变色主题，并有 Loading 骨架屏动画。
4. [ ] 支持在英语和法语环境下正确显示检索结果。
```

## 维护与更新

- 所有的 PRD 变更必须通过 Git 进行版本控制。
- 需求变更后，必须同步更新对应的 `dev-tdd_workflow` 下的测试用例。

---

## 自动化工具

为了提高效率，提供了 PRD 模板生成脚本：

### 1. PRD 模板生成器

快速生成符合本规范的 PRD 初始结构。

**使用方法**:

```bash
python .agent/skills/dev-prd/scripts/generate_prd.py "功能名称"
```

文件将自动生成在 `docs/requirements/` 目录下。

---

_本规范由 dev-prd skill 生成。_
